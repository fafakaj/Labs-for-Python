# Лабораторная работа: Клиент-серверное приложение на Python

## Цель работы

Целью данной лабораторной работы является создание простого клиент-серверного веб-приложения на языке Python **без использования сторонних серверных фреймворков** (таких как Flask или Django). В ходе выполнения работы были решены следующие задачи:

- Реализовано базовое HTTP-приложение с использованием встроенных модулей `http.server` и `urllib.parse` для обработки запросов и маршрутизации.
- Освоена работа с шаблонизатором **Jinja2** для динамического формирования HTML-страниц на основе данных.
- Разработаны **модели предметной области** — `Author`, `App`, `User`, `Currency`, `UserCurrency` — с полной инкапсуляцией, валидацией через геттеры и сеттеры, и соблюдением принципов объектно-ориентированного программирования.
- Архитектура проекта приведена в соответствие с паттерном **MVC (Model–View–Controller)**:  
  — **Model**: классы в пакете `models/`,  
  — **View**: HTML-шаблоны в папке `templates/`,  
  — **Controller**: логика маршрутизации и обработки запросов в `myapp.py` и `controllers/`.
- Интегрирована функция `get_currencies` для получения актуальных курсов валют с официального API Центрального банка РФ, с корректной обработкой ошибок (`ConnectionError`, `ValueError`, `KeyError`, `TypeError`).
- Реализована функциональность **подписки пользователей на валюты**, позволяющая отслеживать интересующие курсы.
- Выполнена **самостоятельная часть**: на странице пользователя отображается **динамика изменения курсов** за последние 4 месяца с использованием JavaScript-библиотеки **Chart.js**.
- Разработаны **unit-тесты** для проверки корректности работы моделей, функции `get_currencies`, контроллера и шаблонов.

В результате реализовано полностью функциональное, модульное и тестируемое приложение, демонстрирующее глубокое понимание принципов веб-разработки на чистом Python.

---

## Описание предметной области

### Модели

#### Author
- `name` — имя автора.
- `group` — учебная группа.

#### App
- `name` — название приложения.
- `version` — версия приложения.
- `author` — объект `Author`.

#### User
- `id` — уникальный идентификатор.
- `name` — имя пользователя.

#### Currency
- `id` — уникальный идентификатор.
- `num_code` — цифровой код.
- `char_code` — символьный код.
- `name` — название валюты.
- `value` — курс.
- `nominal` — номинал (за сколько единиц валюты указан курс).

#### UserCurrency
- `id` — уникальный идентификатор.
- `user_id` — внешний ключ к `User`.
- `currency_id` — внешний ключ к `Currency`.
- Реализует связь «много ко многим» между пользователями и валютами.

---

## Структура проекта
lab8/
├── __init__.py                
├── controllers/
│   ├── __init__.py
│   └── main_controller.py
├── models/
│   ├── __init__.py
│   ├── author.py
│   ├── app.py
│   ├── user.py
│   ├── currency.py
│   └── user_currency.py
├── templates/
│   ├── base.html
│   ├── index.html
│   ├── author.html
│   ├── users.html
│   ├── user.html
│   └── currencies.html
├── static/
│   └── style.css
├── utils/
│   ├── __init__.py
│   └── currencies_api.py
└── myapp.py                   # запуск сервер

---

## Реализация

### Модели

Все модели реализованы в пакете `models/` с полной инкапсуляцией и валидацией данных через геттеры и сеттеры. Например, в `models/currency.py`:

```python
class Currency:
    def __init__(self, id: str, num_code: int, char_code: str, name: str, value: float, nominal: int):
        self.id = id
        self.num_code = num_code
        self.char_code = char_code
        self.name = name
        self.value = value
        self.nominal = nominal

    @property
    def value(self) -> float:
        return self._value

    @value.setter
    def value(self, value: float):
        if not isinstance(value, (int, float)) or value <= 0:
            raise TypeError("Курс валюты должен быть положительным числом")
        self._value = float(value)
```

Контроллер
Маршрутизация реализована в controllers/main_controller.py. Все запросы обрабатываются через handle_request, который вызывает соответствующие функции и рендерит шаблоны с помощью jinja2.Environment.
Пример маршрута /user?id=...:
```python

def handle_user(user_id):
    user = users_db.get(user_id)
    if not user:
        return {"status": 404, "content": "Пользователь не найден"}

    subscribed = user_subscriptions.get(user_id, set())
    ...
    html = render_template("user.html", user=user, ...)
    return {"status": 200, "content": html, ...}
```
Шаблоны

Шаблоны расположены в папке templates/ и используют jinja2. Инициализация Environment:
```python

template_dir = os.path.join(os.path.dirname(__file__), '..', 'templates')
env = Environment(loader=FileSystemLoader(template_dir), autoescape=select_autoescape())
```

Работа с API

Функция get_currencies из utils/myapp.py получает данные с API ЦБ РФ и возвращает словарь {code: value}. В случае ошибки выбрасывается соответствующее исключение.
Подписка и графики

Пользователь может подписаться на любую валюту через GET-запрос /subscribe?user_id=1&currency=USD. Данные о динамике курсов хранятся в currency_history и отображаются на странице пользователя с помощью Chart.js.

Самостоятельная работа: Графики динамики

На странице пользователя отображается график динамики курсов валют, на которые подписан пользователь, за последние 4 месяца. Для визуализации используется библиотека Chart.js.

Выводы

В ходе выполнения лабораторной работы была успешно реализована архитектура MVC, что позволило чётко разделить ответственность между моделями, представлениями и контроллерами. Это значительно упростило разработку и последующее сопровождение проекта.

Работа с HTTPServer и urllib.parse помогла глубже понять, как устроены веб-запросы и как их можно обрабатывать на низком уровне. Использование Jinja2 продемонстрировало мощь шаблонизаторов для создания динамических страниц.

Интеграция с API ЦБ РФ показала важность обработки ошибок и валидации данных. Функциональность подписки и отображения динамики курсов добавила интерактивности и полезности приложению.

Тестирование подтвердило корректность работы всех компонентов и повысило надёжность системы.

В целом, работа позволила освоить ключевые концепции веб-разработки на Python и подготовиться к более сложным проектам.
